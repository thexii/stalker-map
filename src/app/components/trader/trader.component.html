<div class="trader-container">
    <div class="trader-container-section">
        <div class="sell container">
            <stalker-profile [profile]="trader.profile" [game]="game.gameStyle" [money]="trader.money" [hasInfinityMoney]="trader.infinitiveMoney" [rankSetting]="rankSetting"></stalker-profile>
            <div class="inventory-container">
                @if (selectedSellSection) {
                    <div class="sell inventory">
                        @for (sellItem of selectedSellSection.items; track sellItem) {
                            <div tooltip [component]="itemTooltipComponent" [componentData]="{item: sellItem.item}" class="inventory-item inventory-item-width-{{sellItem.item.width}} inventory-item-height-{{sellItem.item.height}}" (click)="selectItem(sellItem.item)">
                                <div class="item-additional-info">
                                    <div class="inventory-item-count">
                                        @if (sellItem.price == 0 || sellItem.price == undefined) {
                                            <span class="stalker-icon icon-bug"></span>
                                        }
                                        {{sellItem.price}}
                                    </div>
                                    @if (sellItem.item.installedUpgrades && sellItem.item.installedUpgrades.length > 0) {
                                        <div class="inventory-item-upgrade"></div>
                                    }
                                </div>
                                <div class="inventory-item-image {{game.gameStyle}} inventory-item-x-{{sellItem.item.gridX}} inventory-item-y-{{sellItem.item.gridY}}">
                                    @if (sellItem.item.hasScope && sellItem.item.scopeX > -1000 && sellItem.item.scopeY > -1000) {
                                        <div class="wpn_addon scope" [style.left.px]="sellItem.item.scopeX" [style.top.px]="sellItem.item.scopeY"></div>
                                    }

                                    @if (sellItem.item.hasSilencer && sellItem.item.silencerX > -1000 && sellItem.item.silencerY > -1000) {
                                        <div class="wpn_addon silencer" [style.left.px]="sellItem.item.silencerX" [style.top.px]="sellItem.item.silencerY"></div>
                                    }

                                    @if (sellItem.item.hasGrenadeLauncher && sellItem.item.grenadeLauncherX > -1000 && sellItem.item.grenadeLauncherY > -1000) {
                                        <div class="wpn_addon grenade-launcher" [style.left.px]="sellItem.item.grenadeLauncherX" [style.top.px]="sellItem.item.grenadeLauncherY"></div>
                                    }
                                </div>
                            </div>
                        }
                    </div>
                }
            </div>
        </div>
    </div>
    <div class="trader-container-section section-info custom-scroll">
        <div class="info container">
            @if (hasMultiplySells || hasMultiplyBuies || hasMultiplySupplies) {
                <div class="sections-select-container custom-scroll">
                    <div class="trader-sections-title">{{'trader-sections-title' | translate}}</div>
                    <table style="width: 100%;">
                        <tr>
                            @if (hasMultiplySells) {
                                <td class="section-td">{{ 'trader-sell' | translate}}</td>
                            }

                            @if (hasMultiplyBuies) {
                                <td class="section-td">{{ 'trader-buy' | translate}}</td>
                            }

                            @if (hasMultiplySupplies) {
                                <td class="section-td">{{ 'trader-supply' | translate}}</td>
                            }

                            @if (hasDicounts) {
                                <td class="section-td">{{ 'discounts' | translate}}</td>
                            }
                        </tr>
                        @for (index of traderSectionIndexes; track index) {
                            <tr>
                                @if (hasMultiplySells) {
                                    @if (traderSellSections[index]) {
                                        <td class="section" (click)="selectSell(traderSellSections[index])" [ngClass]="{'selected': selectedSellSection && selectedSellSection.sectionConditions == traderSellSections[index].sectionConditions}">
                                            @if (traderSellSections[index].sectionConditions) {
                                                {{ traderSellSections[index].sectionConditions | translate }}
                                            }
                                            @else {
                                                {{ "sell_default" | translate}}
                                            }
                                        </td>
                                    }
                                    @else {
                                        <td></td>
                                    }
                                }

                                @if (hasMultiplyBuies) {
                                    @if (traderBuySections[index]) {
                                        <td class="section" (click)="selectBuy(traderBuySections[index])" [ngClass]="{'selected': selectedBuySection && selectedBuySection.sectionConditions == traderBuySections[index].sectionConditions}">
                                            @if (!traderBuySections[index].sectionConditions) {
                                                {{ "buy_default" | translate}}
                                            }
                                            
                                            @if (traderBuySections[index].conditions) {
                                                @for (cond of traderBuySections[index].conditions; track cond) {
                                                    <div>{{ cond | translate}}</div>
                                                }
                                            }
                                        </td>
                                    }
                                    @else {
                                        <td></td>
                                    }
                                }

                                @if (hasMultiplySupplies) {
                                    @if (traderSupplySections[index]) {
                                        <td class="section" (click)="selectSupply(traderSupplySections[index])" [ngClass]="{'selected': selectedSupplySection && selectedSupplySection.sectionConditions == traderSupplySections[index].sectionConditions}">
                                            @if (!traderSupplySections[index].sectionConditions) {
                                                {{ "supply_default" | translate }}
                                            }
                                            
                                            @if (traderSupplySections[index].conditions) {
                                                @for (cond of traderSupplySections[index].conditions; track cond) {
                                                    <div>{{ cond | translate}}</div>
                                                }
                                            }
                                        </td>
                                    }
                                    @else {
                                        <td></td>
                                    }
                                }

                                @if (hasDicounts) {
                                    @if (traderDiscounts[index]) {
                                        <td class="section" (click)="selectDiscount(traderDiscounts[index])" [ngClass]="{'selected': selectedDiscount && selectedDiscount.conditions == traderDiscounts[index].conditions}">
                                            @if (!traderDiscounts[index].conditions) {
                                                {{ "discount_default" | translate }}
                                            }
                                            
                                            @if (traderDiscounts[index].sectionConditions) {
                                                @for (cond of traderDiscounts[index].sectionConditions; track cond) {
                                                    <div>{{ cond | translate}}</div>
                                                }
                                            }
                                            
                                            @if (traderDiscounts[index].buy != 1) {
                                                @if (traderDiscounts[index].buy > 1) {
                                                    <div>{{ 'bad_trader_buy_price' | translate }}: -{{ Math.round((traderDiscounts[index].buy - 1) * 100)}}%</div>
                                                }
                                                @else {
                                                    <div>{{ 'good_trader_buy_price' | translate}}: +{{ Math.round((traderDiscounts[index].buy - 1) * 100)}}%</div>
                                                }
                                            }

                                            @if (traderDiscounts[index].sell != 1) {
                                                @if (traderDiscounts[index].sell < 1) {
                                                    <div>{{ 'good_trader_sell_price' | translate}}: {{ Math.round((traderDiscounts[index].sell - 1) * 100)}}%</div>
                                                }
                                                @else {
                                                    <div>{{ 'bad_trader_sell_price' | translate}}: +{{ Math.round((traderDiscounts[index].sell - 1) * 100)}}%</div>
                                                }
                                            }
                                        </td>
                                    }
                                    @else {
                                        <td></td>
                                    }
                                }
                            </tr>
                        }
                    </table>
                </div>
            }

            @if (selectedItem && selectedItem.item) {
                <div class="selected-item">
                    <table>
                        <tr>
                            <td>{{selectedItem.item.localeName | translate}}</td>
                        </tr>
                        <tr>
                            <td>{{ 'nominal-price' | translate:{price: selectedItem.item.price} }}</td>
                        </tr>

                        @if (selectedItem.item.boxSize > 1) {
                            <tr>
                                <td>{{ 'item-box-size' | translate:{boxSize: selectedItem.item.boxSize} }}</td>
                            </tr>
                        }

                        @if (selectedItem.sell && selectedItem.supply && selectedItem.supply.count > 0) {
                            <tr>
                                <td>{{ 'trade-count-chance' | translate }}:</td>
                            </tr>
                        }

                        @if (selectedItem.sell && !selectedItem.supply) {
                            <tr>
                                <td>{{ 'trader-must-buy-item-firstly' | translate }}</td>
                            </tr>
                        }

                        @if (!selectedItem.sell && selectedItem.supply) {
                            <tr>
                                <td>{{ 'error-in-trade-config' | translate }}</td>
                            </tr>
                        }
                    </table>
                </div>
            }
            <div class="chart-container">
                <canvas id="item-chart" class="chart"
                    [hidden]="!(selectedItem && selectedItem.sell && selectedItem.supply)">{{ chart }}</canvas>
            </div>
            @if (selectedItem) {
                <div class="best-trade-container">
                    @if (selectedItem.supply == null) {
                        <div>
                            @if (selectedItem.traderHasNoSellItem) {
                                <div>
                                    {{ 'trader-dont-sell-item' | translate}}
                                </div>
                            }

                            @if (selectedItem.traderHasNoSellItemInSection) {
                                <div>
                                    {{ 'trader-dont-sell-item-in-section' | translate}}
                                </div>
                            }
                        </div>
                    }

                    @if (selectedItem.bestSell.length > 0) {
                        <div class="best-sells">
                            <div class="best-sell-title">
                                {{ 'best-sell-title' | translate}}
                            </div>
                            <div class="best-sell-container">
                                @for (sell of selectedItem.bestSell; track sell) {
                                    <div class="best-sell-item">
                                        <div class="best-sell-item-price">
                                            {{ Math.floor((sell.item.minCoeficient + (sell.item.maxCoeficient -
                                            sell.item.minCoeficient) / 2) * selectedItem.item.price) }}
                                        </div>
                                        <div class="best-sell-item-info">
                                            <div class="best-trade-trader-name">
                                                {{sell.traderName | translate}}
                                                @if (sell.item.maxCoeficient != sell.item.minCoeficient) {
                                                    <span>(<span class="best-sell-item-price-value good">{{ Math.floor(sell.item.minCoeficient * selectedItem.item.price) }}</span> -
                                                        <span class="best-sell-item-price-value">{{Math.floor((sell.item.minCoeficient + (sell.item.maxCoeficient - sell.item.minCoeficient) / 2) * selectedItem.item.price) }}</span> -
                                                        <span class="best-sell-item-price-value bad">{{Math.floor((sell.item.maxCoeficient * selectedItem.item.price))}}</span> )
                                                    </span>
                                                }
                                            </div>

                                            @if (sell.conditionSell != allwaysCondition) {
                                                <div class="best-trade-trader-condition">
                                                    @for (cond of sell.conditionsSell; track cond) {
                                                        {{ cond | translate}}
                                                    }
                                                </div>
                                            }

                                            @if (sell.conditionSupply && sell.conditionSupply.length > 0) {
                                                <div class="best-trade-trader-condition">
                                                    @for (cond of sell.conditionSupply; track cond) {
                                                        {{ cond | translate}}
                                                    }
                                                </div>
                                            }
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>
                    }

                    <div class="best-buy">
                        <div class="best-sell-title">
                            {{ 'best-buy-title' | translate}}
                        </div>
                        <div class="best-buy-container">
                            @if (selectedItem.bestBuy) {
                                @for (buy of selectedItem.bestBuy; track buy) {
                                    <div class="best-sell-item">
                                        <div class="best-sell-item-price">{{ Math.floor((buy.item.minCoeficient + (buy.item.maxCoeficient - buy.item.minCoeficient) / 2) * selectedItem.item.price) }}</div>

                                        <div class="best-sell-item-info">
                                            <div class="best-trade-trader-name">
                                                {{buy.traderName | translate}}
                                                @if (buy.item.maxCoeficient != buy.item.minCoeficient) {
                                                    <span>(
                                                        <span class="best-sell-item-price-value good">{{Math.floor(buy.item.minCoeficient * selectedItem.item.price) }}</span> -
                                                        <span class="best-sell-item-price-value">{{Math.floor((buy.item.minCoeficient + (buy.item.maxCoeficient - buy.item.minCoeficient) / 2) * selectedItem.item.price) }}</span> -
                                                        <span class="best-sell-item-price-value bad">{{Math.floor((buy.item.maxCoeficient * selectedItem.item.price)) }}</span>
                                                        )
                                                    </span>
                                                }
                                            </div>

                                            @if (buy.conditionsSell) {
                                                <div class="best-trade-trader-condition">
                                                    @for (cond of buy.conditionsSell; track cond) {
                                                        <div>{{ cond | translate}}</div>
                                                    }
                                                </div>
                                            }
                                        </div>
                                    </div>
                                }
                            }
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
    <div class="trader-container-section custom-scroll actor-section">
        <div class="buy container">
            <div class="trader-info">
                <div class="trader-bio">
                    <div class="trader-name">{{ 'actor_name' | translate}}</div>
                    @if (traderConfig == null || traderConfig.enableRelationSelector) {
                        <div class="profile-data-info">
                            @switch (relationType) {
                                @case (relationTypeEnum.selector) {
                                    <select class="select-relation" #relation (change)="setRelationSelect(relation.value)">
                                        <option class="language-selector-option" [value]="0">{{ 'enemy' | translate }}</option>
                                        <option class="language-selector-option" [value]="1" selected>{{ 'neutral' | translate }}
                                        </option>
                                        <option class="language-selector-option" [value]="2">{{ 'friend' | translate }}</option>
                                    </select>
                                }
                                @case (relationTypeEnum.range) {
                                    <div class="relation-range">
                                        <input type="range" min="0" max="1" step="0.01" list="relations-det" [value]="relation" #ranger (input)="setRelationSelectRange(ranger.value)">

                                        <datalist id="relations-det">
                                            @for (relId of [0, 1, 2]; track relId) {
                                                <option [value]="relations[relId]"></option>
                                            }
                                        </datalist>
                                        <div class="range-labels">
                                            @for (relId of [0, 1, 2]; track relId) {
                                                <div>{{relationsTitle[relId] | translate}}</div>
                                            }
                                        </div>
                                    </div>
                                }
                            }
                        </div>
                    }
                </div>
                <div class="stalker-avatar {{game.gameStyle}}"
                    [ngStyle]="{'width': actor.iconWidth + 'px', 'height': actor.iconHeight + 'px', 'background-position': 'left ' + (-actor.iconX) + 'px top ' + (-actor.iconY) + 'px'}">
                </div>
            </div>
            @if (selectedBuySection.items && selectedBuySection.items.length > 0) {
                <div class="inventory-container">
                    @if (selectedBuySection) {
                        <div class="buy inventory">
                            @for (buyItem of selectedBuySection.items; track buyItem) {
                                <div tooltip [component]="itemTooltipComponent" [componentData]="{item: buyItem.item}"
                                    class="inventory-item inventory-item-width-{{buyItem.item.width}} inventory-item-height-{{buyItem.item.height}}"
                                    (click)="selectItem(buyItem.item)">
                                    <div class="item-additional-info">
                                        <div class="inventory-item-count">
                                            @if (buyItem.item.price == 0) {
                                                <span class="stalker-icon icon-bug"></span>
                                            }
                                            {{Math.floor(buyItem.price)}}
                                        </div>
                                        @if (buyItem.item.installedUpgrades && buyItem.item.installedUpgrades.length > 0) {
                                            <div class="inventory-item-upgrade"></div>
                                        }
                                    </div>
                                    <div class="inventory-item-image {{game.gameStyle}} inventory-item-x-{{buyItem.item.gridX}} inventory-item-y-{{buyItem.item.gridY}}">
                                        @if (buyItem.item.hasScope && buyItem.item.scopeX > -1000 && buyItem.item.scopeY > -1000) {
                                            <div class="wpn_addon scope" [style.left.px]="buyItem.item.scopeX" [style.top.px]="buyItem.item.scopeY"></div>
                                        }

                                        @if (buyItem.item.hasSilencer && buyItem.item.silencerX > -1000 && buyItem.item.silencerY > -1000) {
                                            <div class="wpn_addon silencer" [style.left.px]="buyItem.item.silencerX" [style.top.px]="buyItem.item.silencerY"></div>
                                        }

                                        @if (buyItem.item.hasGrenadeLauncher && buyItem.item.grenadeLauncherX > -1000 && buyItem.item.grenadeLauncherY > -1000) {
                                            <div class="wpn_addon grenade-launcher" [style.left.px]="buyItem.item.grenadeLauncherX" [style.top.px]="buyItem.item.grenadeLauncherY"></div>
                                        }
                                    </div>
                                </div>
                            }
                        </div>
                    }
                </div>
            }
            @else {
                <div class="trader-do-not-buy-info">
                    <div>{{ 'trader-do-not-buy' | translate }}</div>
                </div>
            }
        </div>
    </div>
</div>
<div class="bottom">
    <div class="button url-button" (click)="copyLink()">
        <span>{{ 'markLink' | translate}}</span>
    </div>
</div>